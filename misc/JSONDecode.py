import SNOBOL4python
from SNOBOL4python import pattern, MATCH, UCASE, LCASE, _digits
from SNOBOL4python import ε, σ, Σ, Π, π, ξ, Ω, Δ, δ, λ, Λ, θ
from SNOBOL4python import ANY, ARBNO, BREAK, FENCE, LEN, POS, RPOS, SPAN
from SNOBOL4python import CHAR, REPLACE, _RETURN, _NRETURN, _END
from SNOBOL4python import S, F, Ξ
#-------------------------------------------------------------------------------------------------------
_labels = { \
    "_003" : _JSONDecode,
    "_008" : _JSONDecode1,
    "_017" : _JSONDecode2,
    "_018" : _JSONDecode3,
    "_019" : _JSONDecodeEnd
}
#-------------------------------------------------------------------------------------------------------
def _JSONDecodeEnd(): pass
def _JSONDecode1(): pass
def _JSONDecode2(): pass
def _JSONDecode3(): pass
def _JSONDecodeEnd(): pass
def _error(): pass
#-------------------------------------------------------------------------------------------------------
@Ξ(_JSONDecodeEnd)
def _001():         DEFINE('JSONDecode(str)ch,h,h0,h1,h2,h3,xch0,xch1,xch2,xch3,xchs')
def _002():         jHex = '0123456789ABCDEF'
#-------------------------------------------------------------------------------------------------------
@Ξ(_RETURN)
def _JSONDecode():  str in FENCE() + POS(0) + RPOS(0)
#-------------------------------------------------------------------------------------------------------
@S(_JSONDecode1)
def _004():         (str in FENCE() + σ('\\u') + LEN(4) % xchs) << _NULL
#-------------------------------------------------------------------------------------------------------
@S(_JSONDecode2)
def _005():         str in \
                        FENCE() + σ('\\') \
                      + ( σ('\\') % ch
                        | σ('/') % ch
                        | σ('"') % ch
                        | σ("'") % ch
                        | σ('b') + λ("ch = CHAR(8)")
                        | σ('t') + λ("ch = CHAR(9)")
                        | σ('n') + λ("ch = CHAR(10)")
                        | σ('f') + λ("ch = CHAR(12)")
                        | σ('r') + λ("ch = CHAR(13)")
                        ) << _NULL
#-------------------------------------------------------------------------------------------------------
@S(_error)
def _006():         (str in FENCE() + σ('\\')) << _NULL
#-------------------------------------------------------------------------------------------------------
@Ξ(_JSONDecode2, _error)
def _007():         (str in FENCE() + LEN(1) % ch) << _NULL
#-------------------------------------------------------------------------------------------------------
def _JSONDecode1(): xchs = REPLACE(xchs, LCASE, UCASE)
#-------------------------------------------------------------------------------------------------------
@F(_JSONDecode3)
def _009():         xchs in \
                         ( FENCE()
                         + LEN(1) % xch3
                         + LEN(1) % xch2
                         + LEN(1) % xch1
                         + LEN(1) % xch0
                         + RPOS(0)
                         )
#-------------------------------------------------------------------------------------------------------
@F(_JSONDecode3)
def _010():         jHex in BREAK(xch3) + θ(h3)
#-------------------------------------------------------------------------------------------------------
@F(_JSONDecode3)
def _011():         jHex in BREAK(xch2) + θ(h2)
#-------------------------------------------------------------------------------------------------------
@F(_JSONDecode3)
def _012():         jHex in BREAK(xch1) + θ(h1)
#-------------------------------------------------------------------------------------------------------
@F(_JSONDecode3)
def _013():         jHex in BREAK(xch0) + θ(h0)
def _014():         h = ((h3 * 16 + h2) * 16 + h1) * 16 + h0
def _015():         xchs = wchar_to_utf8(h)
#-------------------------------------------------------------------------------------------------------
@Ξ(_JSONDecode)
def _016():         JSONDecode = JSONDecode + xchs
#-------------------------------------------------------------------------------------------------------
@Ξ(_JSONDecode)
def _JSONDecode2(): JSONDecode = JSONDecode + ch
#-------------------------------------------------------------------------------------------------------
@F(_JSONDecode)
def _JSONDecode3(): OUTPUT = 'JSONDecode: Warning: ' + '\\' + 'u' + xchs
#-------------------------------------------------------------------------------------------------------
def _JSONDecodeEnd(): None
#-------------------------------------------------------------------------------------------------------